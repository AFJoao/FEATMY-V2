<div class="signup-page" style="font-family: 'DM Sans', system-ui, sans-serif; background: #FFFFFF; min-height: 100vh; display: flex;">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/mobile-responsive-fixes.css">

  <style>
    .su-input {
      width: 100%; padding: 13px 16px; border: 2px solid #EBEBEB; border-radius: 12px;
      font-size: 0.9rem; outline: none; transition: all 0.2s ease; box-sizing: border-box;
      font-family: inherit; background: #FAFAFA; color: #0A0A0A;
    }
    .su-input:focus { border-color: #0A0A0A; background: #fff; box-shadow: 0 0 0 4px rgba(0,0,0,0.04); }
    .su-input::placeholder { color: #9CA3AF; }
    .su-input[style*="text-transform: uppercase"] { font-family: 'DM Mono', monospace; letter-spacing: 0.12em; font-size: 1.05rem; }
    .su-btn {
      width: 100%; padding: 14px; background: #00E676; color: #0A0A0A; border: none;
      border-radius: 12px; font-size: 0.95rem; font-weight: 800; cursor: pointer;
      transition: all 0.25s cubic-bezier(0.4,0,0.2,1); font-family: inherit;
    }
    .su-btn:hover { background: #00C853; transform: translateY(-1px); box-shadow: 0 8px 24px rgba(0,230,118,0.35); }
    .su-btn:disabled { opacity: 0.55; cursor: not-allowed; transform: none; box-shadow: none; }
    .type-card {
      flex: 1; padding: 16px 14px; border: 2px solid #EBEBEB; border-radius: 14px;
      cursor: pointer; text-align: center; transition: all 0.2s; position: relative; background: #FAFAFA;
    }
    .type-card:hover { border-color: #D1D5DB; background: #fff; }
    .type-card.selected { border-color: #00E676; background: rgba(0,230,118,0.04); }
    .type-card input { position: absolute; opacity: 0; pointer-events: none; }
    .type-ring {
      width: 20px; height: 20px; border-radius: 50%; border: 2px solid #EBEBEB;
      margin: 0 auto 10px; transition: all 0.2s; background: #fff;
    }
    .type-card.selected .type-ring { border-color: #00E676; background: #00E676; }
    .spinner { width: 22px; height: 22px; border: 3px solid rgba(0,0,0,0.08); border-top-color: #00E676; border-radius: 50%; animation: spin 0.8s linear infinite; display: inline-block; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>

  <!-- LEFT PANEL -->
  <div class="su-left" style="width: 44%; background: #0A0A0A; display: flex; flex-direction: column; justify-content: space-between; padding: 48px; position: relative; overflow: hidden; flex-shrink: 0;">
    <div style="position: absolute; inset: 0; background: radial-gradient(ellipse at 25% 75%, rgba(0,230,118,0.08) 0%, transparent 55%), radial-gradient(ellipse at 80% 15%, rgba(255,255,255,0.02) 0%, transparent 50%); pointer-events: none;"></div>

    <!-- LOGO grande e centralizada -->
    <div style="position: relative; flex: 1; display: flex; align-items: center; justify-content: center;">
      <img src="assets/branca_larga.png" alt="Featym" style="width: 72%; max-width: 320px; object-fit: contain; filter: drop-shadow(0 0 40px rgba(0,230,118,0.12));" onerror="this.style.display='none'">
    </div>

    <div style="position: relative;">
      <p style="color: rgba(0,230,118,0.75); font-size: 0.72rem; font-weight: 700; letter-spacing: 0.1em; text-transform: uppercase; margin: 0 0 14px;">Crie sua conta grátis</p>
      <h2 style="color: #fff; font-size: 2rem; font-weight: 800; margin: 0 0 16px; line-height: 1.2; letter-spacing: -0.03em;">Comece sua<br>jornada fitness<br>hoje.</h2>
      <p style="color: rgba(255,255,255,0.4); font-size: 0.85rem; line-height: 1.7; margin: 0 0 28px; max-width: 300px;">Personals gerenciam treinos, alunos acompanham sua evolução.</p>

      <div style="display: flex; flex-direction: column; gap: 10px;">
        <div style="display: flex; align-items: center; gap: 12px;">
          <div style="width: 28px; height: 28px; background: rgba(0,230,118,0.15); border-radius: 8px; display: flex; align-items: center; justify-content: center; border: 1px solid rgba(0,230,118,0.2); flex-shrink: 0;">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#00E676" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
          </div>
          <span style="color: rgba(255,255,255,0.55); font-size: 0.82rem;">Treinos organizados por dia da semana</span>
        </div>
        <div style="display: flex; align-items: center; gap: 12px;">
          <div style="width: 28px; height: 28px; background: rgba(0,230,118,0.15); border-radius: 8px; display: flex; align-items: center; justify-content: center; border: 1px solid rgba(0,230,118,0.2); flex-shrink: 0;">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#00E676" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
          </div>
          <span style="color: rgba(255,255,255,0.55); font-size: 0.82rem;">Feedback em tempo real para o personal</span>
        </div>
        <div style="display: flex; align-items: center; gap: 12px;">
          <div style="width: 28px; height: 28px; background: rgba(0,230,118,0.15); border-radius: 8px; display: flex; align-items: center; justify-content: center; border: 1px solid rgba(0,230,118,0.2); flex-shrink: 0;">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#00E676" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
          </div>
          <span style="color: rgba(255,255,255,0.55); font-size: 0.82rem;">Kanban de exercícios por dia</span>
        </div>
      </div>
    </div>
  </div>

  <!-- RIGHT PANEL -->
  <div style="flex: 1; display: flex; align-items: center; justify-content: center; padding: 48px 56px; overflow-y: auto;">
    <div style="width: 100%; max-width: 420px;">

      <div style="margin-bottom: 28px;">
        <h1 style="font-size: 1.7rem; font-weight: 800; color: #0A0A0A; margin: 0 0 6px; letter-spacing: -0.03em;">Criar conta</h1>
        <p style="color: #6B7280; font-size: 0.875rem; margin: 0;">Preencha os dados abaixo para começar</p>
      </div>

      <div id="signupError" style="display: none; background: #FFF1F2; border: 1px solid #FECDD3; border-radius: 10px; padding: 11px 14px; margin-bottom: 16px; font-size: 0.83rem; color: #BE123C; font-weight: 500;"></div>
      <div id="signupSuccess" style="display: none; background: #ECFDF5; border: 1px solid #A7F3D0; border-radius: 10px; padding: 11px 14px; margin-bottom: 16px; font-size: 0.83rem; color: #047857; font-weight: 500;"></div>

      <form id="signupForm" style="display: flex; flex-direction: column; gap: 14px;">

        <div>
          <label style="display: block; font-size: 0.78rem; font-weight: 700; color: #374151; margin-bottom: 7px;">Nome completo</label>
          <input type="text" id="signupName" class="su-input" placeholder="Seu nome" required>
        </div>

        <div>
          <label style="display: block; font-size: 0.78rem; font-weight: 700; color: #374151; margin-bottom: 7px;">Email</label>
          <input type="email" id="signupEmail" class="su-input" placeholder="seu@email.com" required>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
          <div>
            <label style="display: block; font-size: 0.78rem; font-weight: 700; color: #374151; margin-bottom: 7px;">Senha</label>
            <input type="password" id="signupPassword" class="su-input" placeholder="Mín. 6 caracteres" required minlength="6">
          </div>
          <div>
            <label style="display: block; font-size: 0.78rem; font-weight: 700; color: #374151; margin-bottom: 7px;">Confirmar</label>
            <input type="password" id="signupPasswordConfirm" class="su-input" placeholder="Repita" required minlength="6">
          </div>
        </div>

        <!-- Tipo de usuário -->
        <div>
          <label style="display: block; font-size: 0.78rem; font-weight: 700; color: #374151; margin-bottom: 10px;">Você é</label>
          <div style="display: flex; gap: 10px;">
            <label class="type-card" id="labelPersonal" onclick="selectUserType('personal')">
              <input type="radio" id="typePersonal" name="userType" value="personal" required>
              <div class="type-ring"></div>
              <div style="font-size: 0.85rem; font-weight: 700; color: #0A0A0A;">Personal Trainer</div>
              <div style="font-size: 0.72rem; color: #9CA3AF; margin-top: 3px;">Criar e gerenciar treinos</div>
            </label>
            <label class="type-card" id="labelStudent" onclick="selectUserType('student')">
              <input type="radio" id="typeStudent" name="userType" value="student" required>
              <div class="type-ring"></div>
              <div style="font-size: 0.85rem; font-weight: 700; color: #0A0A0A;">Aluno</div>
              <div style="font-size: 0.72rem; color: #9CA3AF; margin-top: 3px;">Acompanhar meus treinos</div>
            </label>
          </div>
        </div>

        <!-- Código do Personal (só aluno) -->
        <div id="referralGroup" style="display: none;">
          <label style="display: block; font-size: 0.78rem; font-weight: 700; color: #374151; margin-bottom: 7px;">Código do Personal Trainer</label>
          <input type="text" id="referralCode" class="su-input" placeholder="Ex: X7K4M9" maxlength="6" style="text-transform: uppercase;">
          <div id="codeValidation" style="display: none; margin-top: 8px; font-size: 0.8rem; font-weight: 600;"></div>
        </div>

        <button type="submit" class="su-btn" id="signupSubmitBtn" style="margin-top: 4px;">Criar conta</button>
      </form>

      <p style="text-align: center; margin-top: 20px; font-size: 0.875rem; color: #6B7280;">
        Já tem conta? <a href="#/login" style="color: #0A0A0A; font-weight: 700; text-decoration: none;">Faça login →</a>
      </p>
    </div>
  </div>
</div>

<style>
@media (max-width: 768px) {
  .su-left { display: none !important; }
}
</style>

<script>
(function() {
  function selectUserType(type) {
    document.getElementById('labelPersonal').classList.toggle('selected', type === 'personal');
    document.getElementById('labelStudent').classList.toggle('selected', type === 'student');
    const group = document.getElementById('referralGroup');
    const ref = document.getElementById('referralCode');
    if (type === 'student') {
      group.style.display = 'block';
      ref.required = true;
      document.getElementById('typeStudent').checked = true;
    } else {
      group.style.display = 'none';
      ref.required = false;
      ref.value = '';
      document.getElementById('codeValidation').style.display = 'none';
      document.getElementById('typePersonal').checked = true;
    }
  }
  window.selectUserType = selectUserType;

  let valTimeout;
  document.getElementById('referralCode').addEventListener('input', function(e) {
    const code = e.target.value.toUpperCase();
    e.target.value = code;
    const div = document.getElementById('codeValidation');
    if (code.length === 6) {
      clearTimeout(valTimeout);
      valTimeout = setTimeout(async () => {
        div.innerHTML = '<span style="color:#6B7280;">Verificando...</span>';
        div.style.display = 'block';
        try {
          const result = await authManager.checkReferralCode(code);
          if (result.exists) {
            div.innerHTML = `<span style="background:#ECFDF5;border:1px solid #A7F3D0;color:#047857;padding:5px 10px;border-radius:8px;display:inline-block;">✓ Personal: ${result.personalName}</span>`;
          } else {
            div.innerHTML = `<span style="background:#FFF1F2;border:1px solid #FECDD3;color:#BE123C;padding:5px 10px;border-radius:8px;display:inline-block;">✗ Código inválido</span>`;
          }
        } catch(e) {}
      }, 500);
    } else {
      div.style.display = 'none';
    }
  });

  document.getElementById('signupForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const name = document.getElementById('signupName').value.trim();
    const email = document.getElementById('signupEmail').value.trim();
    const password = document.getElementById('signupPassword').value;
    const confirm = document.getElementById('signupPasswordConfirm').value;
    const typeEl = document.querySelector('input[name="userType"]:checked');
    const refCode = document.getElementById('referralCode').value.trim();
    const errDiv = document.getElementById('signupError');
    const okDiv = document.getElementById('signupSuccess');
    const btn = document.getElementById('signupSubmitBtn');

    errDiv.style.display = 'none';
    okDiv.style.display = 'none';

    if (password !== confirm) {
      errDiv.textContent = 'As senhas não conferem.';
      return errDiv.style.display = 'block';
    }
    if (!typeEl) {
      errDiv.textContent = 'Selecione o tipo de usuário.';
      return errDiv.style.display = 'block';
    }
    const userType = typeEl.value;
    if (userType === 'student') {
      if (!refCode || refCode.length !== 6) {
        errDiv.textContent = 'Digite o código de 6 caracteres do seu Personal Trainer.';
        return errDiv.style.display = 'block';
      }
      const check = await authManager.checkReferralCode(refCode);
      if (!check.exists) {
        errDiv.textContent = 'Código de referência inválido. Verifique com seu Personal Trainer.';
        return errDiv.style.display = 'block';
      }
    }

    btn.innerHTML = '<span class="spinner"></span>';
    btn.disabled = true;

    try {
      const result = await authManager.signup(email, password, name, userType, userType === 'student' ? refCode : null);
      if (result.success) {
        if (result.userType === 'personal' && result.referralCode) {
          okDiv.innerHTML = `<strong>Conta criada!</strong> Seu código de referência: <strong style="font-family:'DM Mono',monospace;letter-spacing:0.1em;">${result.referralCode}</strong> — Compartilhe com seus alunos. Redirecionando...`;
          okDiv.style.display = 'block';
          setTimeout(() => router.goToPersonalDashboard(), 4000);
        } else {
          okDiv.innerHTML = '<strong>Conta criada com sucesso!</strong> Redirecionando...';
          okDiv.style.display = 'block';
          setTimeout(() => router.goToStudentDashboard(), 2000);
        }
      } else {
        errDiv.textContent = result.error || 'Erro ao criar conta.';
        errDiv.style.display = 'block';
        btn.textContent = 'Criar conta';
        btn.disabled = false;
      }
    } catch (err) {
      errDiv.textContent = 'Erro inesperado. Tente novamente.';
      errDiv.style.display = 'block';
      btn.textContent = 'Criar conta';
      btn.disabled = false;
    }
  });
})();
</script>

<div class="personal-dashboard" style="font-family: 'DM Sans', system-ui, sans-serif; background: #FFFFFF; min-height: 100vh;">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/mobile-responsive-fixes.css">

  <style>
    .featmy-btn-primary {
      background: #00E676;
      color: #0A0A0A;
      font-weight: 700;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .featmy-btn-primary:hover {
      background: #00C853;
      transform: translateY(-1px);
      box-shadow: 0 8px 24px rgba(0, 230, 118, 0.35);
    }
    .featmy-btn-ghost {
      background: transparent;
      color: rgba(255,255,255,0.85);
      border: 1px solid rgba(255,255,255,0.18);
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .featmy-btn-ghost:hover {
      background: rgba(255,255,255,0.1);
      border-color: rgba(255,255,255,0.4);
      color: #fff;
    }
    .student-card {
      background: #fff;
      border: 1px solid #EBEBEB;
      border-radius: 16px;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .student-card:hover {
      border-color: #00E676;
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.08);
    }
    .code-display {
      font-family: 'DM Mono', monospace;
      letter-spacing: 0.18em;
    }
    .copy-btn {
      background: #00E676;
      color: #0A0A0A;
      font-weight: 700;
      border-radius: 10px;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .copy-btn:hover {
      background: #00C853;
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(0, 230, 118, 0.3);
    }
    .nav-link {
      color: rgba(255,255,255,0.75);
      font-weight: 500;
      font-size: 0.875rem;
      padding: 8px 16px;
      border-radius: 8px;
      border: 1px solid transparent;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 7px;
      text-decoration: none;
      white-space: nowrap;
    }
    .nav-link:hover {
      color: #fff;
      background: rgba(255,255,255,0.09);
      border-color: rgba(255,255,255,0.15);
    }
    .nav-link-accent {
      background: #00E676;
      color: #0A0A0A;
      font-weight: 700;
      padding: 8px 18px;
      border-radius: 8px;
      font-size: 0.875rem;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 7px;
      text-decoration: none;
      white-space: nowrap;
    }
    .nav-link-accent:hover {
      background: #00C853;
      box-shadow: 0 4px 16px rgba(0,230,118,0.3);
    }
    .spinner {
      width: 28px;
      height: 28px;
      border: 3px solid rgba(0,0,0,0.08);
      border-top-color: #00E676;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>

  <!-- HEADER -->
  <header style="background: #0A0A0A; position: sticky; top: 0; z-index: 50; border-bottom: 1px solid rgba(255,255,255,0.06);">
    <div style="max-width: 1400px; margin: 0 auto; padding: 0 32px; height: 64px; display: flex; justify-content: space-between; align-items: center;">
      
      <!-- Logo -->
      <div style="display: flex; align-items: center; gap: 12px;">
        <img src="assets/branca_larga.png" style="height: 28px; object-fit: contain;" onerror="this.style.display='none'">
        <span style="background: rgba(0,230,118,0.15); color: #00E676; font-size: 0.65rem; font-weight: 700; padding: 2px 8px; border-radius: 20px; letter-spacing: 0.04em; text-transform: uppercase; border: 1px solid rgba(0,230,118,0.25);">Personal</span>
      </div>

      <!-- Navigation -->
      <nav style="display: flex; align-items: center; gap: 6px;">
        <a href="#/personal/exercises" class="nav-link">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <path d="M6 4v16M18 4v16M6 12h12M3 4h4M17 4h4M3 20h4M17 20h4"/>
          </svg>
          Exerc√≠cios
        </a>
        <a href="#/personal/create-workout" class="nav-link-accent">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          Criar Treino
        </a>
        <a href="#/personal/feedbacks" class="nav-link">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
          </svg>
          Feedbacks
        </a>
        <button id="logoutBtn" class="nav-link" style="cursor: pointer; background: transparent; border: 1px solid rgba(255,255,255,0.14);">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
            <polyline points="16 17 21 12 16 7"/>
            <line x1="21" y1="12" x2="9" y2="12"/>
          </svg>
          Sair
        </button>
      </nav>
    </div>
  </header>

  <!-- MAIN -->
  <main style="max-width: 1400px; margin: 0 auto; padding: 40px 32px 60px;">

    <!-- Welcome Row -->
    <div style="margin-bottom: 40px; display: flex; justify-content: space-between; align-items: flex-end;">
      <div>
        <p style="color: #9CA3AF; font-size: 0.875rem; font-weight: 500; margin: 0 0 6px 0; letter-spacing: 0.02em;">BEM-VINDO DE VOLTA</p>
        <h1 style="font-size: 2rem; font-weight: 800; color: #0A0A0A; margin: 0; letter-spacing: -0.03em;">Ol√°, <span id="personalName" style="color: #0A0A0A;">...</span> üëã</h1>
        <p style="color: #6B7280; font-size: 0.925rem; margin: 8px 0 0; font-weight: 400;">Gerencie seus alunos e acompanhe a evolu√ß√£o</p>
      </div>
    </div>

    <!-- 2-col grid -->
    <div style="display: grid; grid-template-columns: 380px 1fr; gap: 24px; align-items: start;">

      <!-- LEFT: Referral Code Card -->
      <div style="background: #0A0A0A; border-radius: 20px; padding: 28px; position: sticky; top: 88px;">
        
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 22px;">
          <div style="width: 36px; height: 36px; background: rgba(0,230,118,0.15); border-radius: 10px; display: flex; align-items: center; justify-content: center; border: 1px solid rgba(0,230,118,0.25);">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#00E676" stroke-width="2">
              <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/>
              <line x1="7" y1="7" x2="7.01" y2="7"/>
            </svg>
          </div>
          <div>
            <p style="color: rgba(255,255,255,0.4); font-size: 0.7rem; font-weight: 600; letter-spacing: 0.08em; text-transform: uppercase; margin: 0;">SEU C√ìDIGO</p>
            <p style="color: #fff; font-size: 0.9rem; font-weight: 600; margin: 2px 0 0;">C√≥digo de Refer√™ncia</p>
          </div>
        </div>

        <p style="color: rgba(255,255,255,0.45); font-size: 0.8rem; margin: 0 0 14px; line-height: 1.6;">Compartilhe com seus alunos para que possam se cadastrar</p>

        <!-- Code Box -->
        <div style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px 24px; text-align: center; margin-bottom: 14px;">
          <p id="referralCode" class="code-display" style="font-size: 2.2rem; font-weight: 700; color: #fff; margin: 0;">------</p>
        </div>

        <button id="copyCodeBtn" class="copy-btn" style="width: 100%; padding: 13px; font-size: 0.875rem; display: flex; align-items: center; justify-content: center; gap: 8px; border: none; cursor: pointer;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
          </svg>
          Copiar C√≥digo
        </button>

        <!-- Divider -->
        <div style="border-top: 1px solid rgba(255,255,255,0.08); margin: 20px 0 16px;"></div>

        <!-- Quick Stats -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
          <div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 14px;">
            <p style="color: rgba(255,255,255,0.4); font-size: 0.7rem; font-weight: 600; letter-spacing: 0.06em; text-transform: uppercase; margin: 0 0 4px;">ALUNOS</p>
            <p id="studentsCount" style="color: #fff; font-size: 1.6rem; font-weight: 800; margin: 0; letter-spacing: -0.03em;">0</p>
          </div>
          <div style="background: rgba(0,230,118,0.1); border: 1px solid rgba(0,230,118,0.2); border-radius: 10px; padding: 14px;">
            <p style="color: rgba(0,230,118,0.6); font-size: 0.7rem; font-weight: 600; letter-spacing: 0.06em; text-transform: uppercase; margin: 0 0 4px;">STATUS</p>
            <p style="color: #00E676; font-size: 0.85rem; font-weight: 700; margin: 0;">Ativo ‚óè</p>
          </div>
        </div>
      </div>

      <!-- RIGHT: Students List -->
      <div>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2 style="font-size: 1.25rem; font-weight: 700; color: #0A0A0A; margin: 0; letter-spacing: -0.02em;">
            Meus Alunos
          </h2>
          <button id="reloadStudentsBtn" style="background: #F4F4F4; border: none; color: #6B7280; padding: 8px 16px; border-radius: 8px; font-size: 0.8rem; font-weight: 600; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#EBEBEB'" onmouseout="this.style.background='#F4F4F4'">
            ‚Üª Atualizar
          </button>
        </div>

        <div id="studentsList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 14px;">
          <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px;">
            <div class="spinner" style="margin: 0 auto 16px;"></div>
            <p style="color: #9CA3AF; font-size: 0.875rem; margin: 0;">Carregando alunos...</p>
          </div>
        </div>
      </div>

    </div>
  </main>
</div>

<script>
(async function() {

  let currentReferralCode = "";
  let isLoading = false;

  await new Promise(res => document.readyState === "loading"
    ? document.addEventListener("DOMContentLoaded", res)
    : res()
  );

  await new Promise(r => setTimeout(r, 120));

  console.log('‚úì Dashboard Personal carregado - Bot√£o Feedbacks deve estar vis√≠vel no header');

  const logoutBtn = document.getElementById("logoutBtn");
  if (logoutBtn) {
    logoutBtn.onclick = async () => {
      await authManager.logout();
      router.goToLogin();
    };
  }

  const copyCodeBtn = document.getElementById("copyCodeBtn");
  if (copyCodeBtn) {
    copyCodeBtn.onclick = () => {
      navigator.clipboard.writeText(currentReferralCode).then(() => {
        const orig = copyCodeBtn.innerHTML;
        copyCodeBtn.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"></polyline></svg> Copiado!`;
        setTimeout(() => copyCodeBtn.innerHTML = orig, 2000);
      });
    };
  }

  document.getElementById("reloadStudentsBtn").onclick = () => loadStudents();

  async function loadPersonalData() {
    const data = await dbManager.getCurrentUserData();
    document.getElementById("personalName").textContent = data?.name || "Personal";
    currentReferralCode = data?.referralCode || "ERRO";
    document.getElementById("referralCode").textContent = currentReferralCode;
  }

  async function loadStudents() {
    if (isLoading) return;
    isLoading = true;

    const list = document.getElementById("studentsList");
    const count = document.getElementById("studentsCount");

    list.innerHTML = `
      <div style="grid-column:1/-1; text-align:center; padding:60px 20px;">
        <div class="spinner" style="margin:0 auto 16px;"></div>
        <p style="color:#9CA3AF; font-size:0.875rem; margin:0;">Carregando alunos...</p>
      </div>
    `;

    const students = await dbManager.getMyStudents();
    count.textContent = students.length;

    if (students.length === 0) {
      list.innerHTML = `
        <div style="grid-column:1/-1; padding:48px 32px; background:#FAFAFA; border-radius:16px; border:2px dashed #E5E7EB; text-align:center;">
          <div style="width:52px;height:52px;background:#F4F4F4;border-radius:14px;margin:0 auto 16px;display:flex;align-items:center;justify-content:center;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#9CA3AF" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          </div>
          <p style="font-size:1rem;font-weight:600;color:#374151;margin:0 0 6px;">Nenhum aluno vinculado</p>
          <p style="font-size:0.85rem;color:#9CA3AF;margin:0;">Compartilhe seu c√≥digo de refer√™ncia para que alunos possam se cadastrar</p>
        </div>
      `;
      return isLoading = false;
    }

    list.innerHTML = "";
    students.forEach(st => {
      const initials = (st.name || 'A').split(' ').map(n => n[0]).join('').slice(0, 2).toUpperCase();
      const card = document.createElement("div");
      card.className = "student-card";
      card.style.cssText = "padding:20px;cursor:pointer;";
      card.innerHTML = `
        <div style="display:flex;align-items:center;gap:14px;">
          <div style="width:44px;height:44px;background:#0A0A0A;border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0;">
            <span style="color:#00E676;font-size:0.9rem;font-weight:700;">${initials}</span>
          </div>
          <div style="flex:1;min-width:0;">
            <p style="font-weight:700;font-size:0.95rem;color:#0A0A0A;margin:0 0 3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${st.name}</p>
            <p style="font-size:0.78rem;color:#9CA3AF;margin:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${st.email}</p>
          </div>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#9CA3AF" stroke-width="2" style="flex-shrink:0;"><polyline points="9 18 15 12 9 6"/></svg>
        </div>
      `;
      card.onclick = () => router.goTo(`/personal/student/${st.uid}`);
      list.appendChild(card);
    });

    isLoading = false;
  }

  await loadPersonalData();
  await loadStudents();

})();
</script>

<div class="exercises-page" style="font-family: 'DM Sans', system-ui, sans-serif; background: #FFFFFF; min-height: 100vh;">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/mobile-responsive-fixes.css">

  <style>
    .nav-link { color: rgba(255,255,255,0.75); font-weight: 500; font-size: 0.875rem; padding: 8px 16px; border-radius: 8px; border: 1px solid transparent; transition: all 0.2s ease; display: flex; align-items: center; gap: 7px; text-decoration: none; white-space: nowrap; cursor: pointer; background: transparent; }
    .nav-link:hover { color: #fff; background: rgba(255,255,255,0.09); border-color: rgba(255,255,255,0.15); }
    .nav-link-accent { background: #00E676; color: #0A0A0A; font-weight: 700; padding: 8px 18px; border-radius: 8px; font-size: 0.875rem; transition: all 0.2s ease; display: flex; align-items: center; gap: 7px; text-decoration: none; white-space: nowrap; border: none; cursor: pointer; }
    .nav-link-accent:hover { background: #00C853; box-shadow: 0 4px 16px rgba(0,230,118,0.3); }
    .exercise-card { background: #fff; border: 1px solid #EBEBEB; border-radius: 16px; transition: all 0.25s cubic-bezier(0.4,0,0.2,1); overflow: hidden; }
    .exercise-card:hover { border-color: #00E676; transform: translateY(-2px); box-shadow: 0 12px 32px rgba(0,0,0,0.08); }
    .search-input { width: 100%; padding: 12px 16px 12px 44px; border: 2px solid #EBEBEB; border-radius: 12px; font-size: 0.9rem; outline: none; transition: all 0.2s; font-family: inherit; background: #FAFAFA; box-sizing: border-box; }
    .search-input:focus { border-color: #0A0A0A; background: #fff; }
    .search-input::placeholder { color: #9CA3AF; }
    .filter-chip { padding: 7px 16px; border-radius: 20px; border: 1.5px solid #EBEBEB; font-size: 0.8rem; font-weight: 600; cursor: pointer; transition: all 0.2s; background: #fff; color: #6B7280; white-space: nowrap; font-family: inherit; }
    .filter-chip:hover { border-color: #D1D5DB; color: #374151; }
    .filter-chip.active { background: #0A0A0A; border-color: #0A0A0A; color: #fff; }
    .muscle-badge { padding: 3px 8px; border-radius: 6px; font-size: 0.7rem; font-weight: 700; letter-spacing: 0.03em; }
    .add-btn { background: #00E676; color: #0A0A0A; border: none; border-radius: 8px; padding: 7px 14px; font-size: 0.78rem; font-weight: 700; cursor: pointer; transition: all 0.2s; font-family: inherit; }
    .add-btn:hover { background: #00C853; box-shadow: 0 4px 12px rgba(0,230,118,0.3); }
    .spinner { width: 28px; height: 28px; border: 3px solid rgba(0,0,0,0.08); border-top-color: #00E676; border-radius: 50%; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); z-index: 100; display: flex; align-items: center; justify-content: center; padding: 20px; }
    .modal-box { background: #fff; border-radius: 20px; padding: 32px; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto; }
    .modal-input { width: 100%; padding: 12px 14px; border: 2px solid #EBEBEB; border-radius: 10px; font-size: 0.88rem; outline: none; transition: border-color 0.2s; font-family: inherit; background: #FAFAFA; box-sizing: border-box; }
    .modal-input:focus { border-color: #0A0A0A; background: #fff; }
    .modal-input::placeholder { color: #9CA3AF; }
  </style>

  <!-- HEADER -->
  <header style="background: #0A0A0A; position: sticky; top: 0; z-index: 50; border-bottom: 1px solid rgba(255,255,255,0.06);">
    <div style="max-width: 1400px; margin: 0 auto; padding: 0 32px; height: 64px; display: flex; justify-content: space-between; align-items: center;">
      <div style="display: flex; align-items: center; gap: 12px;">
        <img src="assets/branca_larga.png" alt="Featym" style="height: 28px; object-fit: contain;" onerror="this.style.display='none'">
        <span style="background: rgba(0,230,118,0.15); color: #00E676; font-size: 0.65rem; font-weight: 700; padding: 2px 8px; border-radius: 20px; letter-spacing: 0.04em; text-transform: uppercase; border: 1px solid rgba(0,230,118,0.25);">Personal</span>
      </div>
      <nav style="display: flex; align-items: center; gap: 6px;">
        <a href="#/personal/dashboard" class="nav-link">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
          Dashboard
        </a>
        <a href="#/personal/create-workout" class="nav-link-accent">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          Criar Treino
        </a>
        <a href="#/personal/feedbacks" class="nav-link">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
          Feedbacks
        </a>
        <button id="logoutBtn" class="nav-link" style="border: 1px solid rgba(255,255,255,0.14);">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
          Sair
        </button>
      </nav>
    </div>
  </header>

  <!-- MAIN -->
  <main style="max-width: 1400px; margin: 0 auto; padding: 40px 32px 60px;">

    <!-- Page Header -->
    <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 32px; flex-wrap: wrap; gap: 16px;">
      <div>
        <p style="color: #9CA3AF; font-size: 0.75rem; font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; margin: 0 0 6px;">BIBLIOTECA</p>
        <h1 style="font-size: 1.9rem; font-weight: 800; color: #0A0A0A; margin: 0; letter-spacing: -0.03em;">Exercícios</h1>
      </div>
      <button id="openAddExerciseModal" class="nav-link-accent" style="padding: 10px 22px; font-size: 0.875rem;">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        Novo Exercício
      </button>
    </div>

    <!-- Search + Filters -->
    <div style="background: #FAFAFA; border: 1px solid #EBEBEB; border-radius: 16px; padding: 20px 24px; margin-bottom: 28px;">
      <div style="position: relative; margin-bottom: 16px;">
        <svg style="position: absolute; left: 14px; top: 50%; transform: translateY(-50%); pointer-events: none;" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#9CA3AF" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <input type="text" id="searchInput" class="search-input" placeholder="Buscar exercícios por nome ou músculo...">
      </div>
      <div style="display: flex; gap: 8px; flex-wrap: wrap; align-items: center;">
        <span style="font-size: 0.75rem; font-weight: 700; color: #9CA3AF; letter-spacing: 0.05em; text-transform: uppercase; margin-right: 4px;">Grupo:</span>
        <button class="filter-chip active" data-group="all">Todos</button>
        <button class="filter-chip" data-group="Peito">Peito</button>
        <button class="filter-chip" data-group="Costas">Costas</button>
        <button class="filter-chip" data-group="Pernas">Pernas</button>
        <button class="filter-chip" data-group="Ombros">Ombros</button>
        <button class="filter-chip" data-group="Bíceps">Bíceps</button>
        <button class="filter-chip" data-group="Tríceps">Tríceps</button>
        <button class="filter-chip" data-group="Abdômen">Abdômen</button>
        <button class="filter-chip" data-group="Glúteos">Glúteos</button>
      </div>
    </div>

    <!-- Exercises Grid -->
    <div id="exercisesGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px;">
      <div style="grid-column: 1/-1; text-align: center; padding: 64px 20px;">
        <div class="spinner" style="margin: 0 auto 16px;"></div>
        <p style="color: #9CA3AF; font-size: 0.875rem; margin: 0;">Carregando exercícios...</p>
      </div>
    </div>

  </main>

  <!-- ADD EXERCISE MODAL -->
  <div id="addExerciseModal" class="modal-overlay" style="display: none;">
    <div class="modal-box">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
        <h2 style="font-size: 1.2rem; font-weight: 800; color: #0A0A0A; margin: 0; letter-spacing: -0.02em;">Novo Exercício</h2>
        <button id="closeAddModal" style="background: #F4F4F4; border: none; width: 32px; height: 32px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: #6B7280; font-size: 1.1rem; transition: all 0.2s;">✕</button>
      </div>

      <div id="addExerciseError" style="display: none; background: #FFF1F2; border: 1px solid #FECDD3; border-radius: 8px; padding: 10px 13px; margin-bottom: 16px; font-size: 0.82rem; color: #BE123C; font-weight: 500;"></div>

      <div style="display: flex; flex-direction: column; gap: 14px;">
        <div>
          <label style="display: block; font-size: 0.78rem; font-weight: 700; color: #374151; margin-bottom: 7px;">Nome do exercício *</label>
          <input type="text" id="exName" class="modal-input" placeholder="Ex: Supino Reto com Barra">
        </div>
        <div>
          <label style="display: block; font-size: 0.78rem; font-weight: 700; color: #374151; margin-bottom: 7px;">Grupo muscular *</label>
          <select id="exGroup" class="modal-input" style="appearance: none; cursor: pointer; background: #FAFAFA; padding-right: 36px;">
            <option value="">Selecione o grupo</option>
            <option>Peito</option><option>Costas</option><option>Pernas</option>
            <option>Ombros</option><option>Bíceps</option><option>Tríceps</option>
            <option>Abdômen</option><option>Glúteos</option><option>Panturrilha</option>
            <option>Cardio</option><option>Funcional</option>
          </select>
        </div>
        <div>
          <label style="display: block; font-size: 0.78rem; font-weight: 700; color: #374151; margin-bottom: 7px;">URL do vídeo (YouTube) <span style="color: #9CA3AF; font-weight: 400;">opcional</span></label>
          <input type="url" id="exVideo" class="modal-input" placeholder="https://youtube.com/watch?v=...">
        </div>
        <div>
          <label style="display: block; font-size: 0.78rem; font-weight: 700; color: #374151; margin-bottom: 7px;">Descrição / observações <span style="color: #9CA3AF; font-weight: 400;">opcional</span></label>
          <textarea id="exDesc" class="modal-input" rows="3" placeholder="Dicas de execução, variações..." style="resize: vertical;"></textarea>
        </div>

        <div style="display: flex; gap: 10px; margin-top: 6px;">
          <button id="cancelAddExercise" style="flex: 1; padding: 12px; background: #F4F4F4; color: #374151; border: none; border-radius: 10px; font-size: 0.875rem; font-weight: 600; cursor: pointer; font-family: inherit;">Cancelar</button>
          <button id="saveExerciseBtn" style="flex: 2; padding: 12px; background: #00E676; color: #0A0A0A; border: none; border-radius: 10px; font-size: 0.875rem; font-weight: 800; cursor: pointer; font-family: inherit;">Salvar Exercício</button>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
(async function() {
  // ── Aguardar DOM estar pronto ─────────────────────────────────
  await new Promise(r => document.readyState === 'loading'
    ? document.addEventListener('DOMContentLoaded', r)
    : r()
  );
  await new Promise(r => setTimeout(r, 80));

  const groupColors = {
    'Peito': '#FEF3C7', 'Costas': '#DBEAFE', 'Pernas': '#D1FAE5',
    'Ombros': '#EDE9FE', 'Bíceps': '#FCE7F3', 'Tríceps': '#FEE2E2',
    'Abdômen': '#FFF7ED', 'Glúteos': '#F0FDF4', 'Panturrilha': '#F0F9FF',
    'Cardio': '#FEF9C3', 'Funcional': '#F5F3FF'
  };
  const groupTextColors = {
    'Peito': '#92400E', 'Costas': '#1E40AF', 'Pernas': '#065F46',
    'Ombros': '#5B21B6', 'Bíceps': '#9D174D', 'Tríceps': '#991B1B',
    'Abdômen': '#9A3412', 'Glúteos': '#14532D', 'Panturrilha': '#0C4A6E',
    'Cardio': '#713F12', 'Funcional': '#4C1D95'
  };

  let allExercises = [];
  let currentFilter = 'all';

  // ── Logout ────────────────────────────────────────────────────
  const logoutBtn = document.getElementById('logoutBtn');
  if (logoutBtn) {
    logoutBtn.onclick = async () => {
      await authManager.logout();
      router.goToLogin();
    };
  }

  // ── Modal ─────────────────────────────────────────────────────
  const openBtn = document.getElementById('openAddExerciseModal');
  const closeBtn = document.getElementById('closeAddModal');
  const cancelBtn = document.getElementById('cancelAddExercise');
  const modal = document.getElementById('addExerciseModal');

  if (openBtn) openBtn.onclick = () => { modal.style.display = 'flex'; document.getElementById('exName').focus(); };
  if (closeBtn) closeBtn.onclick = closeModal;
  if (cancelBtn) cancelBtn.onclick = closeModal;
  if (modal) modal.addEventListener('click', e => { if (e.target === modal) closeModal(); });

  function closeModal() {
    if (!modal) return;
    modal.style.display = 'none';
    document.getElementById('exName').value = '';
    document.getElementById('exGroup').value = '';
    document.getElementById('exVideo').value = '';
    document.getElementById('exDesc').value = '';
    const errDiv = document.getElementById('addExerciseError');
    if (errDiv) errDiv.style.display = 'none';
  }

  // ── Salvar exercício ──────────────────────────────────────────
  const saveBtn = document.getElementById('saveExerciseBtn');
  if (saveBtn) {
    saveBtn.onclick = async () => {
      const name = document.getElementById('exName').value.trim();
      const group = document.getElementById('exGroup').value;
      const video = document.getElementById('exVideo').value.trim();
      const desc = document.getElementById('exDesc').value.trim();
      const errDiv = document.getElementById('addExerciseError');

      errDiv.style.display = 'none';
      if (!name) { errDiv.textContent = 'Nome do exercício é obrigatório.'; errDiv.style.display = 'block'; return; }
      if (!group) { errDiv.textContent = 'Selecione o grupo muscular.'; errDiv.style.display = 'block'; return; }

      saveBtn.textContent = 'Salvando...';
      saveBtn.disabled = true;
      try {
        const result = await dbManager.addExercise({ name, muscleGroup: group, videoUrl: video, description: desc });
        if (result && result.success !== false) {
          closeModal();
          await loadExercises();
        } else {
          errDiv.textContent = (result && result.error) || 'Erro ao salvar.';
          errDiv.style.display = 'block';
        }
      } catch(e) {
        errDiv.textContent = 'Erro inesperado ao salvar.';
        errDiv.style.display = 'block';
      }
      saveBtn.textContent = 'Salvar Exercício';
      saveBtn.disabled = false;
    };
  }

  // ── Filtros ───────────────────────────────────────────────────
  document.querySelectorAll('.filter-chip').forEach(chip => {
    chip.addEventListener('click', () => {
      document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
      chip.classList.add('active');
      currentFilter = chip.dataset.group;
      renderExercises();
    });
  });

  const searchInput = document.getElementById('searchInput');
  if (searchInput) searchInput.addEventListener('input', renderExercises);

  // ── Render exercícios ─────────────────────────────────────────
  function renderExercises() {
    const search = (document.getElementById('searchInput')?.value || '').toLowerCase();
    const filtered = allExercises.filter(ex => {
      const matchGroup = currentFilter === 'all' || ex.muscleGroup === currentFilter;
      const matchSearch = !search || (ex.name || '').toLowerCase().includes(search) || (ex.muscleGroup || '').toLowerCase().includes(search);
      return matchGroup && matchSearch;
    });

    const grid = document.getElementById('exercisesGrid');
    if (!grid) return;

    if (filtered.length === 0) {
      grid.innerHTML = `
        <div style="grid-column:1/-1; padding:48px 32px; background:#FAFAFA; border-radius:16px; border:2px dashed #E5E7EB; text-align:center;">
          <p style="font-size:1rem;font-weight:600;color:#374151;margin:0 0 6px;">Nenhum exercício encontrado</p>
          <p style="font-size:0.85rem;color:#9CA3AF;margin:0;">Tente outro filtro ou adicione um novo exercício</p>
        </div>`;
      return;
    }

    grid.innerHTML = '';
    filtered.forEach(ex => {
      const bg = groupColors[ex.muscleGroup] || '#F4F4F4';
      const tc = groupTextColors[ex.muscleGroup] || '#374151';
      const card = document.createElement('div');
      card.className = 'exercise-card';
      card.innerHTML = `
        <div style="padding: 20px 20px 16px;">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:10px;margin-bottom:12px;">
            <h3 style="font-size:0.95rem;font-weight:700;color:#0A0A0A;margin:0;line-height:1.4;flex:1;">${ex.name}</h3>
            <span class="muscle-badge" style="background:${bg};color:${tc};flex-shrink:0;">${ex.muscleGroup || '—'}</span>
          </div>
          ${ex.description ? `<p style="font-size:0.8rem;color:#6B7280;margin:0 0 12px;line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;">${ex.description}</p>` : ''}
          <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
            ${ex.videoUrl ? `<a href="${ex.videoUrl}" target="_blank" rel="noopener" style="display:inline-flex;align-items:center;gap:5px;font-size:0.75rem;font-weight:600;color:#6B7280;text-decoration:none;background:#F4F4F4;padding:5px 10px;border-radius:7px;"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polygon points="5 3 19 12 5 21 5 3"/></svg> Ver vídeo</a>` : ''}
          </div>
        </div>`;
      grid.appendChild(card);
    });
  }

  // ── Carregar exercícios ───────────────────────────────────────
  async function loadExercises() {
    const grid = document.getElementById('exercisesGrid');
    if (!grid) return;
    grid.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:64px 20px;"><div class="spinner" style="margin:0 auto 16px;"></div><p style="color:#9CA3AF;font-size:0.875rem;margin:0;">Carregando...</p></div>`;
    try {
      allExercises = await dbManager.getExercises() || [];
      renderExercises();
    } catch(e) {
      console.error('Erro ao carregar exercícios:', e);
      if (grid) grid.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:48px;"><p style="color:#BE123C;">Erro ao carregar exercícios.</p></div>`;
    }
  }

  await loadExercises();
})();
</script>